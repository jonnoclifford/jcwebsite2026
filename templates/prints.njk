{% extends "base.njk" %}

{% block jsonld %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "Fine Art Prints by Jonathan Clifford",
  "description": "Purchase limited edition fine art prints from Jonathan Clifford's documentary and portrait photography projects.",
  "url": "{{ site.url }}/prints/",
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": {{ prints | length }},
    "itemListElement": [
      {% for print in prints %}
      {
        "@type": "Product",
        "position": {{ loop.index }},
        "name": "{{ print.title }}",
        "description": "{{ print.description }}",
        "image": "{{ site.url }}{{ print.image }}/1200.jpg",
        "offers": {
          "@type": "AggregateOffer",
          "lowPrice": "{{ print.sizes[0].price }}",
          "highPrice": "{{ print.sizes[print.sizes.length - 1].price }}",
          "priceCurrency": "GBP",
          "availability": "https://schema.org/InStock"
        }
      }{% if not loop.last %},{% endif %}
      {% endfor %}
    ]
  }
}
</script>
{% endblock %}

{% block content %}
{# Floating Cart Button #}
<button type="button" id="cart-toggle" class="cart-toggle-float" aria-label="Open shopping cart">
  <svg class="cart-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="9" cy="21" r="1"></circle>
    <circle cx="20" cy="21" r="1"></circle>
    <path d="m1 1 4 4v11a2 2 0 0 0 2 2h13a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2H6"></path>
  </svg>
  <span id="cart-count" class="cart-count" hidden>0</span>
</button>

<section class="prints-store" aria-labelledby="prints-heading">
  <header class="prints-header">
    <h1 id="prints-heading" class="page-title">Prints</h1>
    <p class="prints-intro">Limited edition fine art prints on archival paper.<br>{{ shippingNote }}</p>
  </header>

  <div class="prints-grid" role="list">
    {% for print in prints %}
    <article class="print-card" role="listitem" data-print-id="{{ print.id }}">
      <button
        class="print-card-trigger"
        type="button"
        aria-haspopup="dialog"
        aria-label="View {{ print.title }} print details"
        data-print-trigger="{{ print.id }}"
      >
        <div class="print-card-image">
          <picture>
            <source
              type="image/avif"
              srcset="{{ print.image }}/400.avif 400w, {{ print.image }}/800.avif 800w"
              sizes="(max-width: 768px) 50vw, 25vw"
            >
            <source
              type="image/webp"
              srcset="{{ print.image }}/400.webp 400w, {{ print.image }}/800.webp 800w"
              sizes="(max-width: 768px) 50vw, 25vw"
            >
            <img
              src="{{ print.image }}/800.jpg"
              srcset="{{ print.image }}/400.jpg 400w, {{ print.image }}/800.jpg 800w"
              sizes="(max-width: 768px) 50vw, 25vw"
              alt="{{ print.title }}"
              loading="lazy"
              decoding="async"
            >
          </picture>
        </div>
        <div class="print-card-info">
          <h2 class="print-card-title">{{ print.title }}</h2>
          <p class="print-card-price">From £{{ print.sizes[0].price }}</p>
        </div>
      </button>
    </article>
    {% endfor %}
  </div>

  <footer class="prints-footer">
    <div class="prints-info-block">
      <h2>Print Details</h2>
      <dl class="prints-specs">
        <div class="prints-spec">
          <dt>Paper</dt>
          <dd>{{ defaultPaper }}</dd>
        </div>
        <div class="prints-spec">
          <dt>Edition</dt>
          <dd>Open Edition, signed</dd>
        </div>
        <div class="prints-spec">
          <dt>Production</dt>
          <dd>{{ productionTime }}</dd>
        </div>
      </dl>
    </div>
  </footer>
</section>

{# Print Detail Modal #}
<div
  class="print-modal"
  id="print-modal"
  role="dialog"
  aria-modal="true"
  aria-labelledby="modal-title"
  hidden
>
  <div class="print-modal-backdrop" data-modal-close></div>
  <div class="print-modal-container">
    <button
      class="print-modal-close"
      type="button"
      aria-label="Close"
      data-modal-close
    >
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M18 6L6 18M6 6l12 12"/>
      </svg>
    </button>

    <div class="print-modal-content">
      <div class="print-modal-image">
        <img src="" alt="" id="modal-image">
      </div>

      <div class="print-modal-details">
        <h2 class="print-modal-title" id="modal-title"></h2>
        <p class="print-modal-project" id="modal-project"></p>
        <p class="print-modal-description" id="modal-description"></p>

        <form class="print-order-form" id="print-order-form">
          <fieldset class="print-size-options">
            <legend>Select Size</legend>
            <div class="print-size-buttons" id="size-buttons">
              {# Populated by JavaScript #}
            </div>
          </fieldset>

          <div class="print-summary">
            <div class="print-summary-row">
              <span>Paper</span>
              <span id="summary-paper">{{ defaultPaper }}</span>
            </div>
            <div class="print-summary-row">
              <span>Edition</span>
              <span>Open Edition, signed</span>
            </div>
            <div class="print-summary-row print-summary-total">
              <span>Total</span>
              <span id="summary-price">£0</span>
            </div>
          </div>

          <button type="submit" class="print-buy-button" id="buy-button" disabled>
            Add to Cart
          </button>

          <p class="print-shipping-note">{{ shippingNote }}</p>
        </form>
      </div>
    </div>
  </div>
</div>

{# Store print data for JavaScript #}
<script>
  window.PRINT_STORE_DATA = {{ prints | dump | safe }};
</script>
{% endblock %}

{% block scripts %}
<script src="/js/print-store.js" type="module"></script>
{% endblock %}
