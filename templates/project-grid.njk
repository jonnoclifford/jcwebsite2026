{% extends "base.njk" %}

{# Project Grid Page JSON-LD: ImageGallery schema #}
{% block jsonld %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ImageGallery",
  "name": "{{ project.title }} - Grid View",
  "description": "{{ project.description | default(project.title + ' - Documentary photography project by Jonathan Clifford') | striptags }}",
  "url": "{{ site.url }}/projects/{{ project.slug }}/grid/",
  "mainEntityOfPage": "{{ site.url }}/projects/{{ project.slug }}/",
  "author": {
    "@id": "{{ site.url }}/#photographer"
  },
  "numberOfItems": {{ images | length }},
  "breadcrumb": {
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "{{ site.url }}/"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "Work",
        "item": "{{ site.url }}/work/"
      },
      {
        "@type": "ListItem",
        "position": 3,
        "name": "{{ project.title }}",
        "item": "{{ site.url }}/projects/{{ project.slug }}/"
      },
      {
        "@type": "ListItem",
        "position": 4,
        "name": "Grid",
        "item": "{{ site.url }}/projects/{{ project.slug }}/grid/"
      }
    ]
  }
}
</script>
{% endblock %}

{% block content %}
<article
  class="project-grid-page"
  itemscope
  itemtype="https://schema.org/ImageGallery"
  aria-label="{{ project.title }} image gallery grid view"
>
  {# Project Header - title and slideshow link only #}
  <header class="project-grid-header">
    <h1 class="project-grid-title" itemprop="name">{{ project.title }}</h1>
    <a
      href="/projects/{{ project.slug }}/"
      class="project-slideshow-link"
      aria-label="View {{ project.title }} as slideshow"
    >Slideshow</a>
  </header>

  {# Image Grid #}
  <div
    class="project-grid"
    role="list"
    aria-label="Photo thumbnails - {{ images | length }} images"
  >
    {% for image in images %}
    {% set imgIndex = image.index | padStart(2, '0') %}
    {% set imgPath = '/images/' + project.slug + '/' + imgIndex %}
    <a
      href="/projects/{{ project.slug }}/#{{ loop.index }}"
      class="project-grid-item"
      data-image-index="{{ loop.index0 }}"
      role="listitem"
      aria-label="View photo {{ loop.index }} of {{ images | length }} in slideshow"
    >
      <figure
        class="project-grid-thumbnail blur-up-container"
        {% if image.data and image.data.dominantColor %}style="background-color: {{ image.data.dominantColor }}"{% endif %}
      >
        {% if image.data and image.data.placeholder %}
        <img
          class="blur-placeholder"
          src="{{ image.data.placeholder }}"
          alt=""
          aria-hidden="true"
        >
        {% endif %}
        <picture>
          <source
            type="image/avif"
            srcset="
              {{ imgPath }}/400.avif 400w,
              {{ imgPath }}/800.avif 800w,
              {{ imgPath }}/1200.avif 1200w
            "
            sizes="(max-width: 600px) 50vw, (max-width: 900px) 33vw, 25vw"
          >
          <source
            type="image/webp"
            srcset="
              {{ imgPath }}/400.webp 400w,
              {{ imgPath }}/800.webp 800w,
              {{ imgPath }}/1200.webp 1200w
            "
            sizes="(max-width: 600px) 50vw, (max-width: 900px) 33vw, 25vw"
          >
          <img
            class="blur-up-image"
            src="{{ imgPath }}/400.jpg"
            srcset="
              {{ imgPath }}/400.jpg 400w,
              {{ imgPath }}/800.jpg 800w,
              {{ imgPath }}/1200.jpg 1200w
            "
            sizes="(max-width: 600px) 50vw, (max-width: 900px) 33vw, 25vw"
            alt="{{ project.title }} - photograph {{ loop.index }} of {{ images | length }}{% if project.location %}, {{ project.location }}{% endif %}{% if project.year %} ({{ project.year }}){% endif %}"
            loading="{{ 'eager' if loop.index <= 8 else 'lazy' }}"
            onload="this.closest('.blur-up-container').classList.add('is-loaded')"
          >
        </picture>
        <figcaption class="visually-hidden">
          {{ project.title }} - photograph {{ loop.index }} of {{ images | length }}{% if project.location %}, {{ project.location }}{% endif %}{% if project.year %} ({{ project.year }}){% endif %}
        </figcaption>
      </figure>
    </a>
    {% endfor %}
  </div>
</article>
{% endblock %}
